import java.io.File;

import javax.swing.*;
import javax.swing.filechooser.FileNameExtensionFilter;

public class WindowMenu  extends JMenuBar{
	
	static final long serialVersionUID = 1L;
	public final JMenuItem newMenu;
    public final JMenuItem openMenu;   
    public final JMenuItem saveMenu;   
    public final JMenuItem quitMenu;
	
	
	public WindowMenu(JFrame parent, BudgetModel model, BudgetController controller, WindowMain windowMain){
		
		// Créer la menu Fichier
		JMenu fileMenu = new JMenu("File");
		fileMenu.setFont(model.tahomaFont14);
		
		// Créer les items du menu Fichier

        newMenu  = new JMenuItem("New");
        openMenu = new JMenuItem("Open");
        saveMenu = new JMenuItem("Save");
        quitMenu = new JMenuItem("Quit");

		//Font menu add
		newMenu.setFont(model.tahomaFont12);
		openMenu.setFont(model.tahomaFont12);
		saveMenu.setFont(model.tahomaFont12);
		quitMenu.setFont(model.tahomaFont12);
		
		// Inscrire les événements
		newMenu.addActionListener((e) -> {
			model.getAccountList().clear();
            model.fireTableDataChanged();
            windowMain.onModelCleared();
		});
		
		openMenu.addActionListener((e) -> {
			 JFileChooser chooser = new JFileChooser();
	         chooser.setFileFilter(new FileNameExtensionFilter("Budget JSON (*.json)", "json"));
	         if (chooser.showOpenDialog(parent) == JFileChooser.APPROVE_OPTION) {
	         controller.jsonOpen(chooser.getSelectedFile());
	         }
		});
		
		saveMenu.addActionListener((e) -> {
			JFileChooser chooser = new JFileChooser();
            chooser.setFileFilter(new FileNameExtensionFilter("Budget JSON (*.json)", "json"));
            if (chooser.showSaveDialog(parent) == JFileChooser.APPROVE_OPTION) {
                File file = chooser.getSelectedFile();
                if (!file.getName().toLowerCase().endsWith(".json")) {
                    file = new File(file.getParentFile(), file.getName() + ".json");
                }
                controller.jsonSave(file);
            }
		});
		
		quitMenu.addActionListener((e) -> {
	        	System.exit(0);       	
	    });
		

		// Ajouter les items au menu Fichier
		fileMenu.add(newMenu);
		fileMenu.add(openMenu);
		fileMenu.add(saveMenu);
		fileMenu.addSeparator();  // Ajouter un séparateur
		fileMenu.add(quitMenu);
		
		// Ajouter le menu Fichier à la barre de menu
		add(fileMenu);
		
		// Créer le menu Aide
		JMenu helpMenu = new JMenu("Help");
		
		helpMenu.setFont(model.tahomaFont14);

		// Créer l'item du menu Aide
		JMenuItem aboutMenu = new JMenuItem("About");
		
		//Font menu add
		aboutMenu.setFont(model.tahomaFont12);

		// Inscire l'événement
		//aboutMenu.addActionListener(parent);

		// Ajouter l'item au menu Aide
		helpMenu.add(aboutMenu);

		add(Box.createHorizontalGlue());
		
		// Ajouter le menu Aide à la barre de menu
		add(helpMenu);
		
		aboutMenu.addActionListener((e) -> {
			String message = "<html>Création d'un budget personnel<br><br>Version de l'appilcation 1.0<br><br>Christophe et Guillaume</html>";
			new WindowMessages(parent, model, "About", message);  	
		});
	}
}